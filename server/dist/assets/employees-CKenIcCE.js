import{r as p,j as e,h as E}from"./index-DL9tVKVf.js";const R=({onEmployeeAdded:a})=>{const[h,N]=p.useState(!1),[r,m]=p.useState({firstname:"",lastname:"",email:"",role_en:"",role_de:"",department_en:"",department_de:"",telephone:"",profilePicture:null}),[l,g]=p.useState(null),x=p.useRef(null),u=f=>{const{name:n,value:v}=f.target;m({...r,[n]:v})},t=f=>{const n=f.target.files[0];m({...r,profilePicture:n}),g(n?URL.createObjectURL(n):null)},i=()=>{m(f=>({...f,profilePicture:null})),g(null),x.current&&(x.current.value="")},s=async f=>{var v,w;f.preventDefault();const n=[];if(r.firstname||n.push("First name"),r.lastname||n.push("Last name"),r.email||n.push("Email"),r.role_en||n.push("Role (EN)"),r.role_de||n.push("Role (DE)"),r.department_en||n.push("Department (EN)"),r.department_de||n.push("Department (DE)"),r.telephone||n.push("Telephone"),r.profilePicture||n.push("Profile Picture"),n.length>0){alert("Please provide required fields: "+n.join(", "));return}try{N(!0);const j=new FormData;Object.keys(r).forEach(y=>{y==="profilePicture"?r[y]&&j.append("profilePicture",r[y]):j.append(y,r[y])});const P=await E.createEmployee(j);a(P),m({firstname:"",lastname:"",email:"",role_en:"",role_de:"",department_en:"",department_de:"",telephone:"",profilePicture:null}),g(null)}catch(j){console.error("Error adding employee:",j),alert(((w=(v=j.response)==null?void 0:v.data)==null?void 0:w.error)||"Failed to add employee.")}finally{N(!1)}};return e.jsxs("form",{onSubmit:s,className:"space-y-6 rounded bg-white p-6 shadow-md",encType:"multipart/form-data",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Add New Employee"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["First Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"firstname",value:r.firstname,onChange:u,className:"w-full rounded border p-2",placeholder:"First name",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Last Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"lastname",value:r.lastname,onChange:u,className:"w-full rounded border p-2",placeholder:"Last name",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:u,className:"w-full rounded border p-2",placeholder:"email@example.com",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Role (EN) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"role_en",value:r.role_en,onChange:u,className:"w-full rounded border p-2",placeholder:"e.g. Engineer",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Role (DE) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"role_de",value:r.role_de,onChange:u,className:"w-full rounded border p-2",placeholder:"z. B. Ingenieur",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Department (EN) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"department_en",value:r.department_en,onChange:u,className:"w-full rounded border p-2",placeholder:"e.g. R&D",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Department (DE) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"department_de",value:r.department_de,onChange:u,className:"w-full rounded border p-2",placeholder:"z. B. F&E",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Telephone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"telephone",value:r.telephone,onChange:u,className:"w-full rounded border p-2",placeholder:"e.g. +49 1234 567890",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Profile Picture ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{ref:x,type:"file",name:"profilePicture",accept:"image/*",onChange:t,className:"w-full rounded border p-2",required:!0,"aria-required":"true"}),l&&e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"preview",className:"h-16 w-16 rounded-full object-cover"}),e.jsx("button",{type:"button",onClick:i,className:"absolute right-1/2 top-1/2 flex h-6 w-6 -translate-y-1/2 translate-x-1/2 transform items-center justify-center rounded-full bg-red-500 text-sm font-bold text-white transition hover:bg-red-600","aria-label":"Remove selected image",children:"×"})]})})]}),e.jsx("button",{type:"submit",disabled:h,className:`w-26 flex rounded px-4 py-2 text-on-dark ${h?"cursor-not-allowed bg-gray-400":"bg-primary hover:bg-primary-dark"}`,children:h?"Adding...":"Add Employee"})]})},q=({employee:a,onUpdate:h,onCancel:N})=>{const[r,m]=p.useState({firstname:"",lastname:"",role_en:"",role_de:"",department_en:"",department_de:"",telephone:"",email:"",profilePictureFile:null,profilePictureUrl:""}),[l,g]=p.useState({}),[x,u]=p.useState(!1),t=p.useRef(null);p.useEffect(()=>{var c,o,_,d,b;return a&&(m({firstname:a.firstname||"",lastname:a.lastname||"",email:a.email||"",role_en:((c=a.role)==null?void 0:c.en)||"",role_de:((o=a.role)==null?void 0:o.de)||"",department_en:((_=a.department)==null?void 0:_.en)||"",department_de:((d=a.department)==null?void 0:d.de)||"",telephone:a.telephone||"",profilePictureUrl:((b=a.profilePicture)==null?void 0:b.url)||""}),g({})),()=>{r.profilePictureFile&&r.profilePictureUrl&&URL.revokeObjectURL(r.profilePictureUrl)}},[a]);const i=()=>{const c={};return r.firstname.trim()||(c.firstname="First name is required"),r.lastname.trim()||(c.lastname="Last name is required"),r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(c.email="Invalid email address"):c.email="Email is required",g(c),Object.keys(c).length===0},s=c=>{const{name:o,value:_,files:d}=c.target;if(o==="profilePictureFile"){const b=d[0];b&&m(S=>({...S,profilePictureFile:b,profilePictureUrl:URL.createObjectURL(b)}))}else m(b=>({...b,[o]:_}))},f=async c=>{if(c.preventDefault(),!x){if(!i()){alert("Please fix the errors in the form.");return}u(!0);try{const o=new FormData;if(Object.keys(r).forEach(d=>{d==="profilePictureFile"&&r[d]?o.append("profilePicture",r[d]):r[d]!==null&&r[d]!==void 0&&o.append(d,r[d].toString())}),!r.profilePictureFile){const d=(a==null?void 0:a.profilePicture)||null;d&&o.append("profilePicture",JSON.stringify(d))}console.log("FormData before submission:");for(let[d,b]of o.entries())console.log(`${d}:`,b);const _=await E.updateEmployee(a._id,o);h(_),m(d=>({...d,profilePictureFile:null}))}catch(o){console.error("Failed to update employee:",o)}finally{u(!1)}}},{firstname:n,lastname:v,role_en:w,role_de:j,department_en:P,department_de:y,telephone:D,email:C,profilePictureUrl:F}=r;return e.jsxs("form",{onSubmit:f,className:"mx-auto mb-6 max-w-3xl rounded bg-white p-6 shadow-md",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-gray-700",children:"Edit Employee"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"firstname",className:"mb-1 block font-medium text-gray-700",children:["First Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"firstname",name:"firstname",value:n,onChange:s,placeholder:"First Name",required:!0,className:`input w-full rounded border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ${l.firstname?"border-red-500":"border-gray-300"}`,"aria-invalid":!!l.firstname,"aria-describedby":l.firstname?"firstname-error":void 0}),l.firstname&&e.jsx("p",{id:"firstname-error",className:"mt-1 text-sm text-red-600",children:l.firstname})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"lastname",className:"mb-1 block font-medium text-gray-700",children:["Last Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"lastname",name:"lastname",value:v,onChange:s,placeholder:"Last Name",required:!0,className:`input w-full rounded border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ${l.lastname?"border-red-500":"border-gray-300"}`,"aria-invalid":!!l.lastname,"aria-describedby":l.lastname?"lastname-error":void 0}),l.lastname&&e.jsx("p",{id:"lastname-error",className:"mt-1 text-sm text-red-600",children:l.lastname})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{htmlFor:"email",className:"mb-1 block font-medium text-gray-700",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"email",name:"email",type:"email",value:C,onChange:s,placeholder:"Email",required:!0,className:`input w-full rounded border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ${l.email?"border-red-500":"border-gray-300"}`,"aria-invalid":!!l.email,"aria-describedby":l.email?"email-error":void 0}),l.email&&e.jsx("p",{id:"email-error",className:"mt-1 text-sm text-red-600",children:l.email})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"role_en",className:"mb-1 block font-medium text-gray-700",children:["Role (EN) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"role_en",name:"role_en",value:w,onChange:s,placeholder:"Role in English",required:!0,className:`input w-full rounded border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ${l.role_en?"border-red-500":"border-gray-300"}`,"aria-invalid":!!l.role_en,"aria-describedby":l.role_en?"role_en-error":void 0}),l.role_en&&e.jsx("p",{id:"role_en-error",className:"mt-1 text-sm text-red-600",children:l.role_en})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"role_de",className:"mb-1 block font-medium text-gray-700",children:["Role (DE) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"role_de",name:"role_de",value:j,onChange:s,placeholder:"Rolle auf Deutsch",required:!0,className:`input w-full rounded border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ${l.role_de?"border-red-500":"border-gray-300"}`,"aria-invalid":!!l.role_de,"aria-describedby":l.role_de?"role_de-error":void 0}),l.role_de&&e.jsx("p",{id:"role_de-error",className:"mt-1 text-sm text-red-600",children:l.role_de})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"department_en",className:"mb-1 block font-medium text-gray-700",children:["Department (EN) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"department_en",name:"department_en",value:P,onChange:s,placeholder:"Department in English",required:!0,className:`input w-full rounded border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ${l.department_en?"border-red-500":"border-gray-300"}`,"aria-invalid":!!l.department_en,"aria-describedby":l.department_en?"department_en-error":void 0}),l.department_en&&e.jsx("p",{id:"department_en-error",className:"mt-1 text-sm text-red-600",children:l.department_en})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"department_de",className:"mb-1 block font-medium text-gray-700",children:["Department (DE) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"department_de",name:"department_de",value:y,onChange:s,placeholder:"Abteilung auf Deutsch",required:!0,className:`input w-full rounded border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ${l.department_de?"border-red-500":"border-gray-300"}`,"aria-invalid":!!l.department_de,"aria-describedby":l.department_de?"department_de-error":void 0}),l.department_de&&e.jsx("p",{id:"department_de-error",className:"mt-1 text-sm text-red-600",children:l.department_de})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"telephone",className:"mb-1 block font-medium text-gray-700",children:"Telephone"}),e.jsx("input",{id:"telephone",name:"telephone",value:D,onChange:s,placeholder:"Telephone",className:"input w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"profilePictureFile",className:"mb-1 block font-medium text-gray-700",children:"Upload Profile Picture"}),e.jsx("input",{id:"profilePictureFile",name:"profilePictureFile",type:"file",accept:"image/*",ref:t,onChange:s,className:"w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),e.jsx("div",{className:"mt-2 flex items-center gap-4",children:F&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:F,alt:n,className:"h-16 w-16 rounded-full border border-gray-300 object-cover"}),r.profilePictureFile&&e.jsx("button",{type:"button",onClick:()=>{m(c=>{var o;return{...c,profilePictureFile:null,profilePictureUrl:((o=a==null?void 0:a.profilePicture)==null?void 0:o.url)||""}}),t.current&&(t.current.value="")},className:"absolute right-1/2 top-1/2 flex h-6 w-6 -translate-y-1/2 translate-x-1/2 items-center justify-center rounded-full bg-red-500 text-sm font-bold text-white hover:bg-red-600","aria-label":"Remove selected image",children:"×"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"submit",disabled:x,className:`rounded px-6 py-2 font-semibold text-white shadow focus:outline-none focus:ring-2 focus:ring-blue-500 ${x?"cursor-not-allowed bg-gray-400":"bg-blue-600 hover:bg-blue-700"}`,children:x?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:N,className:"rounded bg-gray-300 px-6 py-2 font-semibold transition hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Cancel"})]})]})};function U(){const[a,h]=p.useState([]),[N,r]=p.useState(!1),[m,l]=p.useState(null),g=async(t,i)=>{if(window.confirm(`Are you sure you want to delete ${t.firstname} ${t.lastname}?`))try{await E.deleteEmployee(i),h(a.filter(s=>s._id!==i))}catch(s){console.error("Failed to delete employee:",s),alert("Failed to delete employee. Please try again.")}},x=t=>{h(i=>[...i,t]),r(!1)},u=t=>{if(!t||!t.firstname||!t.lastname){alert("First name and last name are required.");return}try{h(i=>i.map(s=>s._id===t._id?t:s)),l(null)}catch(i){console.error("Failed to update employee:",i)}};return p.useEffect(()=>{(async()=>{try{const i=await E.getAllEmployees();h(i)}catch(i){console.error("Error fetching employees:",i)}})()},[]),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4 flex flex-row-reverse items-center justify-between",children:e.jsx("button",{onClick:()=>{r(t=>!t),l(null)},className:"rounded bg-green-600 px-4 py-2 text-white hover:bg-green-700",children:N?"Cancel":"Add +"})}),N&&!m&&e.jsx("div",{className:"mb-6",children:e.jsx(R,{onEmployeeAdded:x})}),m&&e.jsx("div",{className:"mb-6",children:e.jsx(q,{employee:m,onUpdate:u,onCancel:()=>l(null)})}),e.jsx("div",{className:"overflow-x-auto rounded-lg bg-white shadow-md",children:e.jsxs("table",{className:"w-full min-w-[700px] border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-200 text-gray-700",children:["Email","First Name","Last Name","Role (EN)","Department (EN)","Telephone","Profile","Actions"].map(t=>e.jsx("th",{scope:"col",className:"border border-gray-300 p-3 text-left align-middle",children:t},t))})}),e.jsx("tbody",{children:a.map(t=>{var i,s,f;return e.jsxs("tr",{className:"transition-colors hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 p-3 align-middle",children:t.email}),e.jsx("td",{className:"border border-gray-300 p-3 align-middle",children:t.firstname}),e.jsx("td",{className:"border border-gray-300 p-3 align-middle",children:t.lastname}),e.jsx("td",{className:"border border-gray-300 p-3 align-middle",children:((i=t.role)==null?void 0:i.en)||(typeof t.role=="string"?t.role:"")}),e.jsx("td",{className:"border border-gray-300 p-3 align-middle",children:((s=t.department)==null?void 0:s.en)||(typeof t.department=="string"?t.department:"")}),e.jsx("td",{className:"border border-gray-300 p-3 align-middle",children:t.telephone}),e.jsx("td",{className:"border border-gray-300 p-3 align-middle",children:e.jsx("img",{className:"mx-auto h-14 w-14 rounded-full object-cover",src:t.profilePicture.url||"/default-profile.png",alt:((f=t.profilePicture)==null?void 0:f.altText)||"Profile Picture"})}),e.jsxs("td",{className:"flex justify-center gap-3 border border-gray-300 p-3 align-middle",children:[e.jsx("button",{onClick:()=>{l(t),r(!1),scrollTo(0,0)},className:"rounded bg-blue-600 px-4 py-1 font-medium text-white shadow transition hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":`Edit employee ${t.firstname} ${t.lastname}`,children:"Edit"}),e.jsx("button",{onClick:()=>g(t,t._id),className:"rounded bg-red-600 px-4 py-1 font-medium text-white shadow transition hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400","aria-label":`Delete employee ${t.firstname} ${t.lastname}`,children:"Delete"})]})]},t._id)})})]})})]})}export{U as component};
