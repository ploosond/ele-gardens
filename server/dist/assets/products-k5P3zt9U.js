import{r as u,j as e,p as E}from"./index-Cs5wVyye.js";import{t as P}from"./index-5sQU16Y4.js";const A=({onProductAdded:m})=>{const[b,y]=u.useState(!1),v=["#D32F2F","#E91E63","#F8BBD0","#FF7043","#FFEB3B","#FFC107","#8E24AA","#B39DDB","#42A5F5","#303F9F","#81C784","#388E3C","#FFFFFF","#F5F5DC","#212121"],[t,f]=u.useState({common_name_en:"",common_name_de:"",description_en:"",description_de:"",height:"",diameter:"",hardiness:"",light:"sun",color:""}),d={sun:"sonne","half-shadow":"halb-schatten",shadow:"schatten"},[j,N]=u.useState([]),[F,a]=u.useState([]),[r,p]=u.useState([]),c=u.useRef(null),w=u.useRef(null),x=l=>{const{name:s,value:n}=l.target;f({...t,[s]:n})},C=l=>{const s=Array.from(l.target.files);if(s.length+j.length>3){alert("You can upload up to 3 images only.");return}const n=s.map(h=>URL.createObjectURL(h));N(h=>[...h,...s]),a(h=>[...h,...n])},i=l=>{N(s=>s.filter((n,h)=>h!==l)),a(s=>{const n=s[l];return n&&URL.revokeObjectURL(n),s.filter((h,_)=>_!==l)}),c.current&&(c.current.value="")},o=async l=>{var n,h;l.preventDefault();const s=[];if(t.common_name_en||s.push("common_name_en"),t.description_en||s.push("description_en"),t.description_de||s.push("description_de"),t.height||s.push("height"),t.diameter||s.push("diameter"),t.hardiness||s.push("hardiness"),t.light||s.push("light"),t.color||s.push("color"),j.length<1&&s.push("images"),s.length>0){p(s),s[0]==="common_name_en"&&w.current&&w.current.focus();return}p([]);try{y(!0);const _={en:t.light,de:d[t.light]},D={...t,height:t.height.replace(/–/g,"-").trim(),diameter:t.diameter.replace(/–/g,"-").trim(),hardiness:t.hardiness.replace(/–/g,"-").trim()},g=new FormData;g.append("common_name_en",t.common_name_en),g.append("common_name_de",t.common_name_de),g.append("description_en",t.description_en),g.append("description_de",t.description_de),g.append("height",D.height),g.append("diameter",D.diameter),g.append("hardiness",D.hardiness),g.append("light_en",_.en),g.append("light_de",_.de),g.append("color",t.color),j.forEach(k=>g.append("images",k));const S=await E.createProduct(g);m(S),f({common_name_en:"",common_name_de:"",description_en:"",description_de:"",height:"",diameter:"",hardiness:"",light:"sun",color:""}),N([]),F.forEach(k=>URL.revokeObjectURL(k)),a([]),c.current&&(c.current.value="")}catch(_){console.error(_),P.error(((h=(n=_.response)==null?void 0:n.data)==null?void 0:h.error)||"Failed to add product.")}finally{y(!1)}};return e.jsxs("form",{onSubmit:o,className:"space-y-6 rounded bg-white p-6 shadow-md",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Add New Product"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"common_name_en",className:"block text-sm font-medium",children:["Common Name (EN) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"common_name_en",ref:w,type:"text",name:"common_name_en",value:t.common_name_en,onChange:x,className:"w-full rounded border p-2",placeholder:"e.g. Ficus lyrata",required:!0,"aria-required":"true","aria-invalid":r.includes("common_name_en"),"aria-describedby":r.includes("common_name_en")?"err_common_name_en":void 0}),r.includes("common_name_en")&&e.jsx("p",{id:"err_common_name_en",className:"mt-1 text-sm text-red-600",children:"Common name (EN) is required."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"common_name_de",className:"block text-sm font-medium",children:"Common Name (DE)"}),e.jsx("input",{id:"common_name_de",type:"text",name:"common_name_de",value:t.common_name_de,onChange:x,className:"w-full rounded border p-2",placeholder:"z.B. Ficus lyrata","aria-invalid":r.includes("common_name_de")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"description_en",className:"block text-sm font-medium",children:["Description (EN) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description_en",name:"description_en",value:t.description_en,onChange:x,className:"w-full rounded border p-2",placeholder:"Short description in English",required:!0,"aria-required":"true","aria-invalid":r.includes("description_en")}),r.includes("description_en")&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"English description is required."})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"description_de",className:"block text-sm font-medium",children:["Description (DE) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description_de",name:"description_de",value:t.description_de,onChange:x,className:"w-full rounded border p-2",placeholder:"Kurze Beschreibung auf Deutsch",required:!0,"aria-required":"true","aria-invalid":r.includes("description_de")}),r.includes("description_de")&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"German description is required."})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Height (cm) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"height",type:"text",name:"height",value:t.height,onChange:x,className:"w-full rounded border p-2",placeholder:"e.g. 10-20",required:!0,"aria-invalid":r.includes("height")}),r.includes("height")&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Height is required."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Diameter (cm) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"diameter",type:"text",name:"diameter",value:t.diameter,onChange:x,className:"w-full rounded border p-2",placeholder:"e.g. 5-10",required:!0,"aria-invalid":r.includes("diameter")}),r.includes("diameter")&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Diameter is required."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Hardiness (°C) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"hardiness",type:"text",name:"hardiness",value:t.hardiness,onChange:x,className:"w-full rounded border p-2",placeholder:"e.g. 3-5",required:!0,"aria-invalid":r.includes("hardiness")}),r.includes("hardiness")&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Hardiness is required."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Light ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"light",name:"light",value:t.light,onChange:l=>f({...t,light:l.target.value}),className:"w-full rounded border p-2",required:!0,"aria-required":"true","aria-invalid":r.includes("light"),children:[e.jsx("option",{value:"sun",children:"Sun"}),e.jsx("option",{value:"half-shadow",children:"Half-Shadow"}),e.jsx("option",{value:"shadow",children:"Shadow"})]}),e.jsxs("p",{className:"mt-1 text-gray-500",children:["DE: ",d[t.light]]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"color",className:"block font-medium text-text",children:"Select Color"}),e.jsx("div",{className:"mt-1 flex gap-2",children:v.map(l=>e.jsx("div",{onClick:()=>f({...t,color:l}),className:`h-8 w-8 cursor-pointer rounded-full border-2 transition-all duration-200 ${t.color===l?"scale-110 border-black":"border-muted"}`,style:{backgroundColor:l}},l))}),r.includes("color")&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Color is required."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"images",className:"block font-medium text-gray-700",children:["Images (1-3) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"images",ref:c,type:"file",accept:"image/*",multiple:!0,onChange:C,className:"w-full rounded border p-2","aria-required":"true","aria-invalid":r.includes("images")}),r.includes("images")&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Please add at least one image (max 3)."}),e.jsx("div",{className:"mt-2 flex flex-row gap-2 overflow-x-auto",children:F.map((l,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:`Product ${s+1}`,className:"h-16 w-16 rounded object-cover"}),e.jsx("button",{type:"button","aria-label":`Remove image ${s+1}`,className:"absolute right-1/2 top-1/2 flex h-6 w-6 -translate-y-1/2 translate-x-1/2 transform items-center justify-center rounded-full bg-red-500 text-sm font-bold text-white transition hover:bg-red-600",onClick:()=>i(s),children:"×"})]},s))})]}),e.jsx("div",{"aria-live":"polite",className:"sr-only",role:"status",children:r.length>0&&`Please correct ${r.length} field(s).`}),e.jsx("button",{type:"submit",disabled:b,className:`w-26 flex rounded px-4 py-2 text-on-dark ${b?"cursor-not-allowed bg-gray-400":"bg-primary hover:bg-primary-dark"}`,children:b?"Adding...":"Add Product"})]})},q=({product:m,onUpdate:b,onCancel:y})=>{const[v,t]=u.useState(!1),f=["#D32F2F","#E91E63","#F8BBD0","#FF7043","#FFEB3B","#FFC107","#8E24AA","#B39DDB","#42A5F5","#303F9F","#81C784","#388E3C","#FFFFFF","#F5F5DC","#212121"],[d,j]=u.useState({common_name_en:"",common_name_de:"",description_en:"",description_de:"",height:"",diameter:"",hardiness:"",light:"sun",color:""}),[N,F]=u.useState([]),[a,r]=u.useState([]),p={sun:"sonne","half-shadow":"halb-schatten",shadow:"schatten"};u.useEffect(()=>{var i,o,l,s,n;return m&&(j({common_name_en:((i=m.common_name)==null?void 0:i.en)||"",common_name_de:((o=m.common_name)==null?void 0:o.de)||"",description_en:((l=m.description)==null?void 0:l.en)||"",description_de:((s=m.description)==null?void 0:s.de)||"",height:m.height||"",diameter:m.diameter||"",hardiness:m.hardiness||"",light:((n=m.light)==null?void 0:n.en)||"sun",color:m.color||""}),F(m.images||[]),r([])),()=>{a.forEach(h=>{URL.revokeObjectURL(h&&h.previewUrl?h.previewUrl:void 0)})}},[m]);const c=i=>{const{name:o,value:l}=i.target;j(s=>({...s,[o]:l}))},w=i=>{const o=Array.from(i.target.files);if(N.length+a.length+o.length>3){alert("You can upload up to 3 images only.");return}const l=o.map(s=>(s.previewUrl=URL.createObjectURL(s),s));r(s=>[...s,...l])},x=(i,o=!1)=>{o?F(l=>l.filter((s,n)=>n!==i)):r(l=>l.filter((s,n)=>n!==i))},C=async i=>{var o,l,s;if(i.preventDefault(),N.length+a.length<1){alert("At least one image is required.");return}try{t(!0);const n=new FormData;n.append("common_name_en",d.common_name_en),n.append("common_name_de",d.common_name_de),n.append("description_en",d.description_en),n.append("description_de",d.description_de),n.append("height",d.height),n.append("diameter",d.diameter),n.append("hardiness",d.hardiness),n.append("light_en",d.light),n.append("light_de",p[d.light]),d.color&&n.append("color",d.color),a.forEach(_=>n.append("images",_)),n.append("existingImages",JSON.stringify(N));const h=await E.updateProduct(m._id,n);b(h)}catch(n){console.error("Failed to update product:",((o=n.response)==null?void 0:o.data)||n.message),alert(((s=(l=n.response)==null?void 0:l.data)==null?void 0:s.error)||"Failed to update product.")}finally{t(!1)}};return e.jsxs("form",{onSubmit:C,className:"mx-auto mb-6 max-w-3xl rounded bg-white p-6 shadow-md",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-gray-700",children:"Edit Product"}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700",children:"Common Name (EN)"}),e.jsx("input",{type:"text",name:"common_name_en",value:d.common_name_en,onChange:c,className:"w-full rounded border p-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700",children:"Common Name (DE)"}),e.jsx("input",{type:"text",name:"common_name_de",value:d.common_name_de,onChange:c,className:"w-full rounded border p-2"})]})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700",children:"Description (EN)"}),e.jsx("textarea",{name:"description_en",value:d.description_en,onChange:c,className:"w-full rounded border p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700",children:"Description (DE)"}),e.jsx("textarea",{name:"description_de",value:d.description_de,onChange:c,className:"w-full rounded border p-2"})]})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",name:"height",value:d.height,onChange:c,placeholder:"Height (cm)",className:"w-full rounded border p-2"}),e.jsx("input",{type:"text",name:"diameter",value:d.diameter,onChange:c,placeholder:"Diameter (cm)",className:"w-full rounded border p-2"}),e.jsx("input",{type:"text",name:"hardiness",value:d.hardiness,onChange:c,placeholder:"Hardiness",className:"w-full rounded border p-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-medium text-gray-700",children:"Light"}),e.jsxs("select",{name:"light",value:d.light,onChange:i=>j({...d,light:i.target.value}),className:"w-full rounded border p-2",children:[e.jsx("option",{value:"sun",children:"Sun"}),e.jsx("option",{value:"half-shadow",children:"Half-Shadow"}),e.jsx("option",{value:"shadow",children:"Shadow"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-medium text-gray-700",children:"Select Color"}),e.jsx("div",{className:"mt-1 flex gap-2",children:f.map(i=>e.jsx("div",{onClick:()=>j({...d,color:i}),className:`h-8 w-8 cursor-pointer rounded-full border-2 transition-all duration-200 ${d.color===i?"scale-110 border-black":"border-gray-300"}`,style:{backgroundColor:i}},i))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-medium text-gray-700",children:"Images (1-3)"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:w,className:"w-full rounded border p-2"}),e.jsxs("div",{className:"mt-2 flex flex-row gap-2 overflow-x-auto",children:[N.map((i,o)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i.url,alt:"Existing",className:"h-16 w-16 rounded object-cover"}),e.jsx("button",{type:"button",onClick:()=>x(o,!0),className:"absolute right-1/2 top-1/2 flex h-6 w-6 -translate-y-1/2 translate-x-1/2 items-center justify-center rounded-full bg-red-500 text-sm font-bold text-white hover:bg-red-600",children:"×"})]},o)),a.map((i,o)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i.previewUrl,alt:"New",className:"h-16 w-16 rounded object-cover"}),e.jsx("button",{type:"button",onClick:()=>{URL.revokeObjectURL(i.previewUrl),x(o)},className:"absolute right-1/2 top-1/2 flex h-6 w-6 -translate-y-1/2 translate-x-1/2 items-center justify-center rounded-full bg-red-500 text-sm font-bold text-white hover:bg-red-600",children:"×"})]},o))]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"submit",disabled:v,className:`rounded px-6 py-2 font-semibold text-white shadow focus:outline-none focus:ring-2 focus:ring-blue-500 ${v?"cursor-not-allowed bg-gray-400":"bg-blue-600 hover:bg-blue-700"}`,children:v?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:y,className:"rounded bg-gray-300 px-6 py-2 font-semibold transition hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Cancel"})]})]})};function U(){const[m,b]=u.useState([]),[y,v]=u.useState(!1),[t,f]=u.useState(null),d=a=>{f(a)},j=a=>{b(r=>r.map(p=>p._id===a._id?a:p)),f(null)},N=async(a,r)=>{window.confirm(`Are you sure you want to delete ${a}?`)&&(await E.deleteProduct(r),b(m.filter(p=>p._id!==r)))},F=a=>{b(r=>[...r,a]),v(!1)};return u.useEffect(()=>{(async()=>{try{const r=await E.getAllProducts();b(r)}catch(r){console.error("Error fetching products:",r)}})()},[]),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4 flex flex-row-reverse items-center justify-between",children:e.jsx("button",{onClick:()=>v(a=>!a),className:"rounded bg-green-600 px-4 py-2 text-white hover:bg-green-700",children:y?"Cancel":"Add +"})}),y&&e.jsx("div",{className:"mb-6",children:e.jsx(A,{onProductAdded:F})}),e.jsxs("table",{className:"w-full border-collapse overflow-hidden rounded-lg bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200 text-gray-700",children:[e.jsx("th",{className:"border p-3",children:"Common Name (EN)"}),e.jsx("th",{className:"border p-3",children:"Common Name (DE)"}),e.jsx("th",{className:"border p-3",children:"Description (EN)"}),e.jsx("th",{className:"border p-3",children:"Description (DE)"}),e.jsx("th",{className:"border p-3",children:"Height (cm)"}),e.jsx("th",{className:"border p-3",children:"Diameter (cm)"}),e.jsx("th",{className:"border p-3",children:"Hardiness (°C)"}),e.jsx("th",{className:"border p-3",children:"Light (EN)"}),e.jsx("th",{className:"border p-3",children:"Light (DE)"}),e.jsx("th",{className:"border p-3",children:"Images"}),e.jsx("th",{className:"border p-3",children:"Actions"})]})}),e.jsx("tbody",{children:[...m].sort((a,r)=>{var p,c;return(((p=a.common_name)==null?void 0:p.en)||"").localeCompare(((c=r.common_name)==null?void 0:c.en)||"")}).map(a=>{var r,p,c,w,x,C;return(t==null?void 0:t._id)===a._id?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"p-3",children:e.jsx(q,{product:a,onUpdate:j,onCancel:()=>f(null)})})},a._id):e.jsxs("tr",{className:"hover:bg-gray-100",children:[e.jsx("td",{className:"border p-3",children:(r=a.common_name)==null?void 0:r.en}),e.jsx("td",{className:"border p-3",children:(p=a.common_name)==null?void 0:p.de}),e.jsx("td",{className:"border p-3",children:(c=a.description)==null?void 0:c.en}),e.jsx("td",{className:"border p-3",children:(w=a.description)==null?void 0:w.de}),e.jsx("td",{className:"border p-3",children:a.height}),e.jsx("td",{className:"border p-3",children:a.diameter}),e.jsx("td",{className:"border p-3",children:a.hardiness}),e.jsx("td",{className:"border p-3",children:(x=a.light)==null?void 0:x.en}),e.jsx("td",{className:"border p-3",children:(C=a.light)==null?void 0:C.de}),e.jsx("td",{className:"border p-3",children:e.jsx("div",{className:"flex flex-col gap-2",children:(Array.isArray(a.images)?a.images:[]).map(i=>e.jsx("img",{className:"h-16 w-16 rounded object-cover",src:i.url,alt:i.altText||"Product Image"},i.url))})}),e.jsxs("td",{className:"flex flex-col gap-2 border p-3",children:[e.jsx("button",{onClick:()=>d(a),className:"rounded bg-blue-500 px-3 py-1 text-white hover:bg-blue-600",children:"Edit"}),e.jsx("button",{onClick:async()=>{var i;try{await N((i=a.common_name)==null?void 0:i.en,a._id)}catch{alert("Failed to delete product.")}},className:"rounded bg-red-500 px-3 py-1 text-white hover:bg-red-600",children:"Delete"})]})]},a._id)})})]})]})}export{U as component};
